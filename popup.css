* { box-sizing: border-box; margin: 0; padding: 0; }

:root {
  --c-primary: #007aff;
  --c-primary-hover: #0066d6;
  --c-danger: #ff3b30;
  --c-success: #34c759;
  --c-bg-app: rgba(242,242,247,0.95);
  --c-bg-card: rgba(255,255,255,0.85);
  --c-bg-card-hover: #f8f8f8;
  --c-text-main: #000000;
  --c-text-secondary: #8e8e93;
  --c-border: rgba(0,0,0,0.1);
  --r-card: 12px;
  --r-button: 8px;
  --t-fast: 0.15s ease;
  --t-normal: 0.2s ease;
}

/* Dark theme via class */
.theme-dark {
  --c-bg-app: rgba(28,28,30,0.95);
  --c-bg-card: rgba(44,44,46,0.85);
  --c-bg-card-hover: #3a3a3c;
  --c-text-main: #ffffff;
  --c-text-secondary: #98989d;
  --c-border: rgba(255,255,255,0.1);
}

/* System preference (only when .theme-system is applied) */
@media (prefers-color-scheme: dark) {
  .theme-system {
    --c-bg-app: rgba(28,28,30,0.95);
    --c-bg-card: rgba(44,44,46,0.85);
    --c-bg-card-hover: #3a3a3c;
    --c-text-main: #ffffff;
    --c-text-secondary: #98989d;
    --c-border: rgba(255,255,255,0.1);
  }
}

body { font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Text', sans-serif; overflow: hidden; }
.app { width: 420px; height: 500px; max-height: 600px; background: url('bg.jpg') center/cover no-repeat fixed; position: relative; color: var(--c-text-main); overflow: hidden; }
.app::before { content: ''; position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: var(--c-bg-app); z-index: 0; }
.app > * { position: relative; z-index: 1; }

/* Header */
.header { background: var(--c-bg-card); padding: 12px 16px; display: flex; align-items: center; justify-content: space-between; border-bottom: 0.5px solid var(--c-border); }
.header-left { display: flex; align-items: center; gap: 8px; }
.header h1 { font-size: 17px; font-weight: 600; color: var(--c-text-main); }
.header-btn { background: none; border: none; color: var(--c-primary); font-size: 15px; cursor: pointer; }
.refresh-btn { width: 28px; height: 28px; border: none; border-radius: 6px; background: transparent; font-size: 16px; cursor: pointer; color: var(--c-primary); margin-top: 2px; }
.refresh-btn:hover { background: rgba(0,122,255,0.1); }
.refresh-btn.loading { animation: spin 0.8s linear infinite; }
.refresh-btn.loading::after { display: none; }

/* Tabs */
.tabs { display: flex; background: rgba(118,118,128,0.12); margin: 12px 16px; border-radius: 8px; padding: 2px; }
.tab { flex: 1; padding: 6px 12px; border: none; background: transparent; border-radius: 6px; font-size: 13px; cursor: pointer; color: var(--c-text-main); transition: all 0.2s; }
.tab.active { background: var(--c-bg-card); box-shadow: 0 1px 3px rgba(0,0,0,0.1); }

/* Panels */
.panel { display: none; padding: 0 16px 80px; position: relative; min-height: 300px; overflow-y: auto; overflow-x: hidden; max-height: calc(500px - 45px - 46px); }
.panel::-webkit-scrollbar { width: 4px; }
.panel::-webkit-scrollbar-track { background: transparent; }
.panel::-webkit-scrollbar-thumb { background: rgba(142, 142, 147, 0.4); border-radius: 4px; }
.panel.active { display: block; }

/* Search */
.search-input { width: 100%; padding: 10px 12px; border: none; border-radius: 10px; background: rgba(118,118,128,0.12); font-size: 15px; margin-bottom: 12px; color: var(--c-text-main); }
.search-input:focus { outline: none; background: var(--c-bg-card); box-shadow: 0 0 0 1px var(--c-primary); }

/* List */
.list { max-height: none; overflow-y: auto; padding-bottom: 8px; }
.list::-webkit-scrollbar { width: 4px; }
.list::-webkit-scrollbar-track { background: transparent; }
.list::-webkit-scrollbar-thumb { background: rgba(142, 142, 147, 0.4); border-radius: 4px; }
.list::-webkit-scrollbar-thumb:hover { background: rgba(142, 142, 147, 0.6); }
.list-item { background: var(--c-bg-card); border-radius: var(--r-card); margin-bottom: 8px; overflow: hidden; position: relative; animation: slideIn 0.25s ease-out backwards; }
.list-item:nth-child(1) { animation-delay: 0.02s; }
.list-item:nth-child(2) { animation-delay: 0.04s; }
.list-item:nth-child(3) { animation-delay: 0.06s; }
.list-item:nth-child(4) { animation-delay: 0.08s; }
.list-item:nth-child(5) { animation-delay: 0.10s; }

@keyframes slideIn {
  from { opacity: 0; transform: translateY(8px); }
  to { opacity: 1; transform: translateY(0); }
}

/* Skeleton */
.skeleton-item { pointer-events: none; }
.skeleton-text { background: linear-gradient(90deg, rgba(0,0,0,0.06) 25%, rgba(0,0,0,0.1) 50%, rgba(0,0,0,0.06) 75%); background-size: 200% 100%; border-radius: 4px; animation: shimmer 1.5s infinite; }
@keyframes shimmer {
  0% { background-position: 200% 0; }
  100% { background-position: -200% 0; }
}
.theme-dark .skeleton-text,
.theme-system .skeleton-text-dark { background: linear-gradient(90deg, rgba(255,255,255,0.06) 25%, rgba(255,255,255,0.1) 50%, rgba(255,255,255,0.06) 75%); background-size: 200% 100%; }
@media (prefers-color-scheme: dark) {
  .theme-system .skeleton-text { background: linear-gradient(90deg, rgba(255,255,255,0.06) 25%, rgba(255,255,255,0.1) 50%, rgba(255,255,255,0.06) 75%); background-size: 200% 100%; }
}

/* Empty State */
.empty-state { text-align: center; padding: 40px 20px; color: var(--c-text-secondary); }
.empty-state-icon { font-size: 48px; margin-bottom: 12px; opacity: 0.5; }
.empty-state-text { font-size: 15px; line-height: 1.5; }
.list-item-header { padding: 12px 14px; cursor: pointer; display: flex; justify-content: space-between; align-items: flex-start; }
.list-item-header:hover { background: var(--c-bg-card-hover); }
.list-item-info { flex: 1; min-width: 0; }
.list-item-title { font-size: 15px; font-weight: 500; color: var(--c-text-main); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.list-item-time { font-size: 13px; color: var(--c-text-secondary); margin-top: 2px; }
.list-item-meta { font-size: 12px; color: var(--c-text-secondary); margin-top: 2px; }
.list-item-preview { font-size: 14px; color: var(--c-text-secondary); padding: 0 14px 12px; line-height: 1.4; white-space: pre-wrap; word-break: break-all; max-height: 60px; overflow: hidden; }

/* Action Toggle - Three dots */
.action-toggle {
  width: 32px;
  height: 32px;
  padding: 0;
  border: none;
  background: transparent;
  cursor: pointer;
  border-radius: 6px;
  flex-shrink: 0;
  transition: background var(--t-fast);
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 3px;
}

.action-toggle::before,
.action-toggle::after,
.action-toggle span {
  content: '';
  width: 5px;
  height: 5px;
  background: var(--c-text-secondary);
  border-radius: 50%;
  transition: background var(--t-fast);
}

.action-toggle:hover {
  background: rgba(0,0,0,0.05);
}

.action-toggle:hover::before,
.action-toggle:hover::after,
.action-toggle:hover span {
  background: var(--c-primary);
}

.theme-dark .action-toggle:hover,
.theme-system .action-toggle:hover {
  background: rgba(255,255,255,0.08);
}

@media (prefers-color-scheme: dark) {
  .theme-system .action-toggle:hover { background: rgba(255,255,255,0.08); }
}

/* Action Menu (collapsible) */
.list-item-actions { display: flex; border-top: 0.5px solid var(--c-border); overflow: hidden; max-height: 0; transition: max-height var(--t-normal); }
.list-item-actions.visible { max-height: 50px; }
.list-item-actions button { flex: 1; padding: 10px; border: none; background: none; color: var(--c-primary); font-size: 14px; cursor: pointer; border-right: 0.5px solid var(--c-border); transition: background var(--t-fast); }
.list-item-actions button:last-child { border-right: none; }
.list-item-actions button.danger { color: var(--c-danger); }
.list-item-actions button:hover { background: var(--c-bg-card-hover); }
.list-item-actions button:disabled { opacity: 0.5; cursor: not-allowed; }

/* FAB */
.fab { position: fixed; bottom: 20px; right: 20px; width: 50px; height: 50px; border-radius: 25px; background: var(--c-primary); color: #fff; border: none; font-size: 28px; cursor: pointer; box-shadow: 0 4px 12px rgba(0,122,255,0.4); transition: transform var(--t-normal), box-shadow var(--t-normal); }
.fab:hover { transform: scale(1.08); box-shadow: 0 6px 20px rgba(0,122,255,0.5); }
.fab:active { transform: scale(0.96); }

/* Settings Panel - Compact No-Scroll Design */
.settings-panel {
  padding: 0 !important;
  background: var(--c-bg-app);
  overflow: hidden !important;
  max-height: none !important;
  min-height: auto !important;
}

.settings-panel.active {
  display: block;
}

.settings-form {
  padding: 16px;
  display: flex;
  flex-direction: column;
  gap: 16px;
  overflow: hidden;
}

/* Form Section */
.form-section {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.form-label {
  font-size: 13px;
  font-weight: 500;
  color: var(--c-text-secondary);
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

/* Form Card (grouped inputs) */
.form-card {
  background: var(--c-bg-card);
  border-radius: var(--r-card);
  overflow: hidden;
}

.form-row {
  display: flex;
}

.form-row .form-input {
  flex: 1;
  padding: 12px 14px;
  border: none;
  border-bottom: 0.5px solid var(--c-border);
  border-radius: 0;
  font-size: 15px;
  background: transparent;
  color: var(--c-text-main);
}

.form-row:last-child .form-input {
  border-bottom: none;
}

.form-row .form-input:focus {
  outline: none;
  background: rgba(0,122,255,0.03);
}

.form-row-split .form-input {
  border-right: 0.5px solid var(--c-border);
}

.form-row-split .form-input:last-child,
.form-row-split .input-with-icon {
  border-right: none;
}

/* Input with icon (password toggle) */
.input-with-icon {
  flex: 1;
  display: flex;
  align-items: center;
  position: relative;
}

.input-with-icon .form-input {
  flex: 1;
  padding-right: 40px;
  width: 100%;
}

.input-icon-btn {
  position: absolute;
  right: 10px;
  top: 50%;
  transform: translateY(-50%);
  width: 24px;
  height: 24px;
  border: none;
  background: transparent;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  color: var(--c-text-secondary);
  border-radius: 4px;
  transition: all var(--t-fast);
  z-index: 1;
}

.input-icon-btn:hover {
  color: var(--c-primary);
  background: rgba(0,122,255,0.08);
}

.input-icon-btn svg {
  width: 18px;
  height: 18px;
  display: block;
}

/* Theme Selector - Horizontal Compact */
.theme-selector {
  display: flex;
  gap: 8px;
}

.theme-option {
  flex: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 4px;
  padding: 10px 8px;
  border: 1.5px solid var(--c-border);
  border-radius: var(--r-card);
  background: var(--c-bg-card);
  cursor: pointer;
  transition: all var(--t-fast);
}

.theme-option:hover {
  border-color: var(--c-primary);
  background: rgba(0,122,255,0.05);
}

.theme-option.active {
  border-color: var(--c-primary);
  background: rgba(0,122,255,0.08);
}

.theme-icon {
  font-size: 18px;
}

.theme-label {
  font-size: 12px;
  color: var(--c-text-main);
  font-weight: 500;
}

/* Form Actions */
.form-actions {
  display: flex;
  gap: 10px;
  margin-top: 8px;
}

.form-actions .btn-secondary,
.form-actions .btn-primary {
  flex: 1;
  padding: 12px;
  border-radius: var(--r-card);
  font-size: 15px;
  font-weight: 500;
  cursor: pointer;
  transition: all var(--t-fast);
}

.form-actions .btn-secondary {
  border: 1.5px solid var(--c-primary);
  background: var(--c-bg-card);
  color: var(--c-primary);
}

.form-actions .btn-primary {
  border: none;
  background: var(--c-primary);
  color: #fff;
}

.form-actions .btn-secondary:hover {
  background: rgba(0,122,255,0.08);
}

.form-actions .btn-primary:hover {
  background: var(--c-primary-hover);
}

/* Legacy form-group support */
.form-group { margin-bottom: 16px; }
.form-group label { display: block; font-size: 13px; color: var(--c-text-secondary); margin-bottom: 6px; }
.form-group input { width: 100%; padding: 10px 12px; border: 1px solid var(--c-border); border-radius: var(--r-button); font-size: 15px; background: var(--c-bg-card); color: var(--c-text-main); }
.form-group input:focus { outline: none; border-color: var(--c-primary); }

.btn-group { display: flex; gap: 8px; margin-top: 20px; }
.btn-secondary { flex: 1; padding: 12px; border: 1px solid var(--c-primary); background: var(--c-bg-card); color: var(--c-primary); border-radius: var(--r-button); font-size: 15px; cursor: pointer; }
.btn-primary { flex: 1; padding: 12px; border: none; background: var(--c-primary); color: #fff; border-radius: var(--r-button); font-size: 15px; cursor: pointer; }
.btn-secondary:hover { background: rgba(0,122,255,0.1); }
.btn-primary:hover { background: var(--c-primary-hover); }
.btn-primary:disabled, .btn-secondary:disabled { opacity: 0.5; cursor: not-allowed; }

/* Modal */
.modal { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.4); z-index: 100; }
.modal.active { display: flex; align-items: flex-end; justify-content: center; }
.modal-content { background: var(--c-bg-app); width: 100%; max-height: 80%; border-radius: var(--r-card) var(--r-card) 0 0; display: flex; flex-direction: column; }
.modal-header { display: flex; align-items: center; justify-content: space-between; padding: 12px 16px; background: var(--c-bg-card); border-bottom: 0.5px solid var(--c-border); border-radius: var(--r-card) var(--r-card) 0 0; }
.modal-header h3 { font-size: 17px; font-weight: 600; color: var(--c-text-main); }
.modal-btn { background: none; border: none; color: var(--c-primary); font-size: 15px; cursor: pointer; }
.modal-btn.primary { font-weight: 600; }
.modal-content input { margin: 12px 16px 0; padding: 10px 12px; border: 1px solid var(--c-border); border-radius: var(--r-button); font-size: 15px; background: var(--c-bg-card); color: var(--c-text-main); }
.modal-content textarea { margin: 12px 16px 16px; padding: 12px; border: 1px solid var(--c-border); border-radius: var(--r-button); font-size: 15px; min-height: 150px; resize: none; flex: 1; background: var(--c-bg-card); color: var(--c-text-main); }
.modal-content input:focus, .modal-content textarea:focus { outline: none; border-color: var(--c-primary); }

/* Delete Confirm Dialog */
.modal-dialog { background: var(--c-bg-card); border-radius: 14px; width: 270px; margin: auto; overflow: hidden; }
.modal-dialog-title { font-size: 17px; font-weight: 600; text-align: center; padding: 16px 16px 8px; color: var(--c-text-main); }
.modal-dialog-msg { font-size: 13px; color: var(--c-text-secondary); text-align: center; padding: 0 16px 16px; }
.modal-dialog-actions { display: flex; border-top: 0.5px solid var(--c-border); }
.dialog-btn { flex: 1; padding: 12px; border: none; background: none; font-size: 17px; color: var(--c-primary); cursor: pointer; }
.dialog-btn:first-child { border-right: 0.5px solid var(--c-border); }
.dialog-btn.danger { color: var(--c-danger); font-weight: 600; }
.dialog-btn:hover { background: var(--c-bg-card-hover); }

/* Drop Zone */
.drop-zone { border: 2px dashed var(--c-text-secondary); border-radius: var(--r-card); padding: 20px; text-align: center; margin-bottom: 12px; transition: all var(--t-normal); }
.drop-zone.dragover { border-color: var(--c-primary); background: rgba(0,122,255,0.05); }
.drop-zone-text { color: var(--c-text-secondary); font-size: 14px; }

/* Progress Bar */
.progress-bar { background: var(--c-border); border-radius: var(--r-button); height: 24px; margin-bottom: 12px; position: relative; overflow: hidden; }
.progress-fill { background: var(--c-primary); height: 100%; width: 0%; transition: width var(--t-normal); border-radius: var(--r-button); }
.progress-text { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 12px; font-weight: 500; color: var(--c-text-main); }

/* Status */
#status { position: fixed; bottom: 80px; left: 50%; transform: translateX(-50%); padding: 10px 20px; border-radius: 20px; font-size: 14px; z-index: 200; opacity: 0; transition: opacity 0.3s; }
#status.show { opacity: 1; }
#status.success { background: var(--c-success); color: #fff; }
#status.error { background: var(--c-danger); color: #fff; }

/* Loading */
.loading { pointer-events: none; opacity: 0.7; }
.loading::after { content: ''; display: inline-block; width: 14px; height: 14px; border: 2px solid transparent; border-top-color: currentColor; border-radius: 50%; animation: spin 0.8s linear infinite; margin-left: 6px; vertical-align: middle; }
@keyframes spin { to { transform: rotate(360deg); } }

/* Preview */
.preview-content { max-height: 90%; }
.preview-body { padding: 16px; overflow: auto; max-height: 350px; background: var(--c-bg-card); }
.preview-body img { max-width: 100%; border-radius: var(--r-button); }
.preview-body pre { white-space: pre-wrap; word-break: break-all; font-size: 13px; margin: 0; color: var(--c-text-main); }
.preview-body .no-preview { text-align: center; color: var(--c-text-secondary); padding: 40px; }

/* Drag Sort */
.list-item.dragging { opacity: 0.5; }

/* Button active state */
button:active { transform: scale(0.96); }

/* Reduced motion */
@media (prefers-reduced-motion: reduce) {
  .list-item { animation: none; }
  .skeleton-text { animation: none; background: rgba(0,0,0,0.08); }
  .fab, .list-item-actions, button { transition: none; }
}
